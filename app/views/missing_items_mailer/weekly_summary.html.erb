<h1>Relatório Semanal de Itens em Falta</h1>

<p>Período: <strong><%= I18n.l(@week_start, format: :short) %> a <%= I18n.l(@week_end, format: :short) %></strong></p>

<div style="background-color: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
  <h2 style="margin-top: 0;">Resumo</h2>

  <table style="width: 100%; border-collapse: collapse;">
    <tr style="background-color: #e9ecef;">
      <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Urgência</th>
      <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6;">Quantidade</th>
    </tr>
    <tr>
      <td style="padding: 10px; border: 1px solid #dee2e6;">
        <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #dc3545; color: white;">Crítica</span>
      </td>
      <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;"><%= @count_critica %></td>
    </tr>
    <tr style="background-color: #f8f9fa;">
      <td style="padding: 10px; border: 1px solid #dee2e6;">
        <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #fd7e14; color: white;">Alta</span>
      </td>
      <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;"><%= @count_alta %></td>
    </tr>
    <tr>
      <td style="padding: 10px; border: 1px solid #dee2e6;">
        <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #17a2b8; color: white;">Média</span>
      </td>
      <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;"><%= @count_media %></td>
    </tr>
    <tr style="background-color: #f8f9fa;">
      <td style="padding: 10px; border: 1px solid #dee2e6;">
        <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background-color: #6c757d; color: white;">Baixa</span>
      </td>
      <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;"><%= @count_baixa %></td>
    </tr>
    <tr style="background-color: #343a40; color: white; font-weight: bold;">
      <td style="padding: 10px; border: 1px solid #dee2e6;">TOTAL PENDENTE</td>
      <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6;"><%= @total_pending %></td>
    </tr>
  </table>
</div>

<% if @total_pending > 0 %>
  <h2>Itens Pendentes</h2>

  <% @items_by_urgency.each do |urgency, items| %>
    <% next if items.empty? %>

    <h3 style="margin-top: 30px; color: <%= urgency == :critica ? '#dc3545' : urgency == :alta ? '#fd7e14' : urgency == :media ? '#17a2b8' : '#6c757d' %>;">
      <%= { critica: 'Crítica', alta: 'Alta', media: 'Média', baixa: 'Baixa' }[urgency] %> (<%= items.count %>)
    </h3>

    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
      <thead>
        <tr style="background-color: #e9ecef;">
          <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Item</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Fonte</th>
          <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Data</th>
        </tr>
      </thead>
      <tbody>
        <% items.each do |item| %>
          <tr>
            <td style="padding: 10px; border: 1px solid #dee2e6;"><%= item.item_name %></td>
            <td style="padding: 10px; border: 1px solid #dee2e6;"><%= item.source_text %></td>
            <td style="padding: 10px; border: 1px solid #dee2e6;"><%= I18n.l(item.created_at, format: :short) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% else %>
  <div style="background-color: #d4edda; border: 1px solid #c3e6cb; padding: 15px; margin: 20px 0; border-radius: 4px;">
    <p style="margin: 0; color: #155724;">
      ✓ <strong>Excelente!</strong> Não há itens em falta pendentes no momento.
    </p>
  </div>
<% end %>

<p style="margin-top: 30px;">
  Para mais detalhes e para gerir os itens em falta, acesse o sistema de gestão de inventário.
</p>

<p style="margin-top: 20px; font-size: 12px; color: #6c757d;">
  <em>Este é um relatório automático semanal do sistema <%= @company_name %>.</em>
</p>
