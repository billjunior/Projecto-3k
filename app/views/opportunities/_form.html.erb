<%= form_with(model: opportunity, local: true) do |form| %>
  <% if opportunity.errors.any? %>
    <div class="alert alert-danger">
      <h5><%= pluralize(opportunity.errors.count, "erro") %>:</h5>
      <ul class="mb-0"><% opportunity.errors.full_messages.each do |message| %><li><%= message %></li><% end %></ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-8">
      <div class="mb-3">
        <%= form.label :title, 'Título', class: 'form-label' %>
        <%= form.text_field :title, class: 'form-control', required: true %>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <%= form.label :customer_id, 'Cliente', class: 'form-label' %>
        <%= form.collection_select :customer_id, Customer.all.order(:name), :id, :name, { include_blank: 'Selecione...' }, class: 'form-select', required: true %>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :description, 'Descrição', class: 'form-label' %>
    <%= form.text_area :description, rows: 4, class: 'form-control' %>
  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="mb-3">
        <%= form.label :value, 'Valor (AOA)', class: 'form-label' %>
        <%= form.number_field :value, class: 'form-control', step: '0.01' %>
      </div>
    </div>
    <div class="col-md-3">
      <div class="mb-3">
        <%= form.label :probability, 'Probabilidade (%)', class: 'form-label' %>
        <%= form.number_field :probability, class: 'form-control', min: 0, max: 100 %>
      </div>
    </div>
    <div class="col-md-3">
      <div class="mb-3">
        <%= form.label :stage, 'Fase', class: 'form-label' %>
        <%= form.select :stage, [['Novo', 'new_opportunity'], ['Qualificado', 'qualified'], ['Proposta', 'proposal'], ['Negociação', 'negotiation']], {}, class: 'form-select' %>
      </div>
    </div>
    <div class="col-md-3">
      <div class="mb-3">
        <%= form.label :expected_close_date, 'Previsão de Fecho', class: 'form-label' %>
        <%= form.date_field :expected_close_date, class: 'form-control' %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      <div class="mb-3">
        <%= form.label :assigned_to_user_id, 'Responsável', class: 'form-label' %>
        <%= form.collection_select :assigned_to_user_id, User.all, :id, :name, { include_blank: 'Selecione...' }, class: 'form-select' %>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <%= form.label :contact_source, 'Como nos contactou', class: 'form-label' %>
        <%= form.select :contact_source, [['WhatsApp', 'whatsapp'], ['Telefone', 'telefone'], ['Instagram', 'instagram'], ['Facebook', 'facebook'], ['X (Twitter)', 'twitter'], ['Outro', 'outro']], { include_blank: 'Selecione...' }, class: 'form-select' %>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <%= form.label :lead_id, 'Lead Origem', class: 'form-label' %>
        <%= form.collection_select :lead_id, Lead.not_converted, :id, :name, { include_blank: 'Nenhum' }, class: 'form-select' %>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2">
    <%= form.submit 'Guardar', class: 'btn btn-primary' %>
    <%= link_to 'Cancelar', opportunity.persisted? ? opportunity : opportunities_path, class: 'btn btn-secondary' %>
  </div>
<% end %>
