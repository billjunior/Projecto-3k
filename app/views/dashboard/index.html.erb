<div class="container-fluid">
  <div class="row mb-4">
    <div class="col">
      <h1><i class="bi bi-speedometer2"></i> Painel</h1>
      <p class="text-muted">Bem-vindo, <%= current_user.email %> (<%= current_user.role.capitalize %>)</p>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card text-white bg-primary">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-2">Clientes</h6>
              <h2 class="card-title mb-0"><%= @customers_count %></h2>
            </div>
            <i class="bi bi-people fs-1 opacity-50"></i>
          </div>
          <small><%= link_to 'Ver todos', customers_path, class: 'text-white text-decoration-none' %> →</small>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card text-white bg-success">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-2">Trabalhos Ativos</h6>
              <h2 class="card-title mb-0"><%= @active_jobs %></h2>
            </div>
            <i class="bi bi-printer fs-1 opacity-50"></i>
          </div>
          <small><%= link_to 'Ver trabalhos', jobs_path, class: 'text-white text-decoration-none' %> →</small>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card text-white bg-warning">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-2">Faturas Pendentes</h6>
              <h2 class="card-title mb-0"><%= @pending_invoices %></h2>
            </div>
            <i class="bi bi-receipt fs-1 opacity-50"></i>
          </div>
          <small><%= link_to 'Ver faturas', invoices_path, class: 'text-white text-decoration-none' %> →</small>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card bg-dark text-white">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-cash-stack"></i> Receita de Hoje</h5>
          <h2 class="mb-0"><%= number_to_currency(@today_revenue, unit: "AOA", separator: ",", delimiter: ".") %></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="bi bi-lightning"></i> Ações Rápidas</h5>
        </div>
        <div class="card-body">
          <div class="row g-2">
            <div class="col-md-3">
              <%= link_to new_customer_path, class: 'btn btn-outline-primary w-100' do %>
                <i class="bi bi-person-plus"></i> Novo Cliente
              <% end %>
            </div>
            <div class="col-md-3">
              <%= link_to new_estimate_path, class: 'btn btn-outline-success w-100' do %>
                <i class="bi bi-file-earmark-text"></i> Novo Orçamento
              <% end %>
            </div>
            <div class="col-md-3">
              <%= link_to new_job_path, class: 'btn btn-outline-info w-100' do %>
                <i class="bi bi-printer"></i> Novo Trabalho
              <% end %>
            </div>
            <div class="col-md-3">
              <%= link_to new_invoice_path, class: 'btn btn-outline-warning w-100' do %>
                <i class="bi bi-receipt"></i> Nova Fatura
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activities -->
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="bi bi-clock-history"></i> Trabalhos Recentes</h5>
        </div>
        <div class="card-body p-0">
          <% if @recent_jobs.any? %>
            <div class="list-group list-group-flush">
              <% @recent_jobs.each do |job| %>
                <div class="list-group-item">
                  <div class="d-flex justify-content-between">
                    <strong>#<%= job.id %></strong>
                    <span class="badge bg-<%= job.status == 'completed' ? 'success' : 'warning' %>">
                      <%= job.status&.capitalize %>
                    </span>
                  </div>
                  <small class="text-muted">Cliente: <%= job.customer.name %></small><br>
                  <small class="text-muted"><%= job.created_at.strftime('%d/%m/%Y %H:%M') %></small>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="p-3 text-muted mb-0">Nenhum trabalho recente</p>
          <% end %>
        </div>
        <div class="card-footer">
          <%= link_to 'Ver todos os trabalhos', jobs_path, class: 'btn btn-sm btn-outline-primary w-100' %>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="bi bi-list-check"></i> Tarefas Pendentes</h5>
        </div>
        <div class="card-body p-0">
          <% if @pending_tasks.any? %>
            <div class="list-group list-group-flush">
              <% @pending_tasks.each do |task| %>
                <div class="list-group-item">
                  <div class="d-flex justify-content-between">
                    <strong><%= task.title %></strong>
                    <% if task.due_date %>
                      <small class="text-<%= task.due_date < Date.today ? 'danger' : 'muted' %>">
                        <%= task.due_date.strftime('%d/%m') %>
                      </small>
                    <% end %>
                  </div>
                  <small class="text-muted"><%= task.description&.truncate(50) %></small>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="p-3 text-muted mb-0">Nenhuma tarefa pendente</p>
          <% end %>
        </div>
        <div class="card-footer">
          <%= link_to 'Ver todas as tarefas', tasks_path, class: 'btn btn-sm btn-outline-secondary w-100' %>
        </div>
      </div>
    </div>
  </div>
</div>
