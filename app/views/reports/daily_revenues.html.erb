<div class="container-fluid">
  <div class="row mb-4">
    <div class="col">
      <h1><i class="bi bi-cash-coin"></i> Relatório de Receitas Diárias</h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><%= link_to 'Relatórios', reports_path %></li>
          <li class="breadcrumb-item active">Receitas Diárias</li>
        </ol>
      </nav>
    </div>
    <div class="col-auto">
      <%= link_to daily_revenues_reports_path(month: @month, year: @year, format: :pdf), class: 'btn btn-danger', target: '_blank' do %>
        <i class="bi bi-file-pdf"></i> Exportar PDF
      <% end %>
    </div>
  </div>

  <!-- Filtro de Mês/Ano -->
  <div class="card mb-4">
    <div class="card-body">
      <%= form_with url: daily_revenues_reports_path, method: :get, class: 'row g-3' do |f| %>
        <div class="col-md-4">
          <label class="form-label">Mês</label>
          <%= select_tag :month, options_for_select(opcoes_meses, @month), class: 'form-select' %>
        </div>
        <div class="col-md-4">
          <label class="form-label">Ano</label>
          <%= select_tag :year, options_for_select((Date.today.year-14..Date.today.year+1).to_a.reverse, @year), class: 'form-select' %>
        </div>
        <div class="col-md-4">
          <%= submit_tag 'Filtrar', class: 'btn btn-primary', style: 'margin-top: 32px;' %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Estatísticas -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h6>Total Entradas</h6>
          <h2><%= number_to_currency(@total_entries, unit: 'AOA', separator: ',', delimiter: '.') %></h2>
          <small><%= @entries_count %> registos</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-danger text-white">
        <div class="card-body text-center">
          <h6>Total Saídas</h6>
          <h2><%= number_to_currency(@total_exits, unit: 'AOA', separator: ',', delimiter: '.') %></h2>
          <small><%= @exits_count %> registos</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h6>Saldo</h6>
          <h2><%= number_to_currency(@total_balance, unit: 'AOA', separator: ',', delimiter: '.') %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h6>Período</h6>
          <h2><%= nome_mes(@month) %> <%= @year %></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabela -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Receitas de <%= nome_mes(@month) %> de <%= @year %></h5>
    </div>
    <div class="card-body p-0">
      <% if @daily_revenues.any? %>
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th class="text-end">Entrada</th>
                <th class="text-end">Saída</th>
                <th class="text-end">Total</th>
                <th class="text-center">Pagamento</th>
              </tr>
            </thead>
            <tbody>
              <% @daily_revenues.each do |revenue| %>
                <tr>
                  <td><%= revenue.date.strftime('%d/%m/%Y') %></td>
                  <td><%= revenue.description %></td>
                  <td class="text-end">
                    <%= revenue.entry ? number_to_currency(revenue.entry, unit: 'AOA', separator: ',', delimiter: '.') : '-' %>
                  </td>
                  <td class="text-end">
                    <%= revenue.exit ? number_to_currency(revenue.exit, unit: 'AOA', separator: ',', delimiter: '.') : '-' %>
                  </td>
                  <td class="text-end">
                    <strong><%= number_to_currency(revenue.total || 0, unit: 'AOA', separator: ',', delimiter: '.') %></strong>
                  </td>
                  <td class="text-center">
                    <%= revenue.manual? ? 'Manual' : 'Transferência' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <div class="mt-3 d-flex justify-content-center">
          <%= paginate @daily_revenues %>
        </div>
      <% else %>
        <div class="text-center py-5 text-muted">
          <i class="bi bi-inbox fs-1"></i>
          <p class="mt-2">Nenhuma receita registrada neste período</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
