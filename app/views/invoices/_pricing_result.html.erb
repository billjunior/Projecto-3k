<div class="card">
  <div class="card-header bg-warning text-dark">
    <h5 class="mb-0"><i class="bi bi-currency-exchange"></i> Resultado do Cálculo - Margem de Contribuição</h5>
  </div>
  <div class="card-body">
    <% if calculator.fixed_variable_costs > 0 %>
      <h6 class="text-primary mb-3"><i class="bi bi-cash-stack"></i> Custos Variáveis Fixos</h6>

      <div class="row mb-3">
        <div class="col-6">
          <p class="text-muted mb-1">Mão de Obra</p>
          <h6><%= number_to_currency(calculator.labor_cost, unit: 'AOA', separator: ',', delimiter: '.') %></h6>
        </div>
        <div class="col-6">
          <p class="text-muted mb-1">Matéria-Prima</p>
          <h6><%= number_to_currency(calculator.material_cost, unit: 'AOA', separator: ',', delimiter: '.') %></h6>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-6">
          <p class="text-muted mb-1">Preço de Compra</p>
          <h6><%= number_to_currency(calculator.purchase_price, unit: 'AOA', separator: ',', delimiter: '.') %></h6>
        </div>
        <div class="col-6">
          <p class="text-muted mb-1">Embalagem</p>
          <h6><%= number_to_currency(calculator.packaging_cost, unit: 'AOA', separator: ',', delimiter: '.') %></h6>
        </div>
      </div>

      <% if calculator.percentage_costs_rate > 0 %>
        <h6 class="text-warning mb-3 mt-4"><i class="bi bi-percent"></i> Custos Variáveis Percentuais</h6>

        <div class="row mb-3">
          <div class="col-4">
            <p class="text-muted mb-1 small">Comissão</p>
            <h6><%= number_with_precision(calculator.sales_commission_percentage, precision: 2) %>%</h6>
          </div>
          <div class="col-4">
            <p class="text-muted mb-1 small">Impostos</p>
            <h6><%= number_with_precision(calculator.sales_tax_percentage, precision: 2) %>%</h6>
          </div>
          <div class="col-4">
            <p class="text-muted mb-1 small">Taxa Cartão</p>
            <h6><%= number_with_precision(calculator.card_fee_percentage, precision: 2) %>%</h6>
          </div>
        </div>
      <% end %>

      <hr>

      <div class="bg-light p-3 rounded mb-3">
        <div class="row">
          <div class="col-6">
            <p class="text-muted mb-1">CV Fixos</p>
            <h5 class="mb-0"><%= number_to_currency(calculator.fixed_variable_costs, unit: 'AOA', separator: ',', delimiter: '.') %></h5>
          </div>
          <div class="col-6">
            <p class="text-muted mb-1">CV Totais</p>
            <h5 class="mb-0"><%= number_to_currency(calculator.total_variable_costs, unit: 'AOA', separator: ',', delimiter: '.') %></h5>
          </div>
        </div>
      </div>

      <div class="bg-success text-white p-4 rounded mb-3 text-center">
        <p class="mb-1"><i class="bi bi-tag-fill"></i> Preço de Venda Sugerido (PV)</p>
        <h1 class="mb-0"><%= number_to_currency(calculator.suggested_price, unit: 'AOA', separator: ',', delimiter: '.') %></h1>
        <small class="d-block mt-2">Fórmula: PV = CV ÷ (1 - MC%)</small>
      </div>

      <div class="row">
        <div class="col-6">
          <div class="card bg-info text-white">
            <div class="card-body text-center">
              <p class="mb-1 small">MCu (Margem Contribuição)</p>
              <h5 class="mb-0"><%= number_to_currency(calculator.contribution_margin_amount, unit: 'AOA', separator: ',', delimiter: '.') %></h5>
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="card bg-primary text-white">
            <div class="card-body text-center">
              <p class="mb-1 small">MC% Real</p>
              <h5 class="mb-0"><%= number_with_precision(calculator.actual_contribution_margin_percentage, precision: 1) %>%</h5>
              <small>Alvo: <%= number_with_precision(calculator.target_contribution_margin_percentage, precision: 0) %>%</small>
            </div>
          </div>
        </div>
      </div>

      <div class="alert alert-info mt-3 mb-0">
        <i class="bi bi-lightbulb"></i>
        <strong>Dica:</strong> O preço foi arredondado para <%= number_to_currency(calculator.suggested_price, unit: 'AOA', separator: ',', delimiter: '.') %> (múltiplo de 100 AOA).
      </div>
    <% else %>
      <div class="text-center text-muted py-5">
        <i class="bi bi-calculator fs-1"></i>
        <p class="mt-3 mb-0">Insira os valores de custo para calcular o preço sugerido</p>
        <small class="d-block mt-2">Metodologia: Margem de Contribuição (PV = CV ÷ (1 - MC%))</small>
      </div>
    <% end %>
  </div>
</div>
