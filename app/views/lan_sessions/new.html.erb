<div class="container">
  <div class="row mb-4">
    <div class="col">
      <h1><i class="bi bi-play-circle"></i> Iniciar Nova Sessão</h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><%= link_to 'Painel', root_path %></li>
          <li class="breadcrumb-item"><%= link_to 'Máquinas LAN', lan_machines_path %></li>
          <li class="breadcrumb-item active">Nova Sessão</li>
        </ol>
      </nav>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <%= form_with(model: @lan_session, local: true) do |form| %>
        <% if @lan_session.errors.any? %>
          <div class="alert alert-danger">
            <h5><%= pluralize(@lan_session.errors.count, "erro") %>:</h5>
            <ul class="mb-0">
              <% @lan_session.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <%= form.label :lan_machine_id, 'Máquina', class: 'form-label' %>
              <%= form.select :lan_machine_id,
                  options_from_collection_for_select(@available_machines, :id, :name, @lan_session.lan_machine_id),
                  { prompt: 'Selecione uma máquina disponível' },
                  class: 'form-select',
                  required: true %>
              <% if @available_machines.empty? %>
                <small class="text-danger">Nenhuma máquina disponível no momento</small>
              <% end %>
            </div>
          </div>

          <div class="col-md-6">
            <div class="mb-3">
              <%= form.label :customer_id, 'Cliente', class: 'form-label' %>
              <%= form.select :customer_id,
                  options_from_collection_for_select(@customers, :id, :name, @lan_session.customer_id),
                  { prompt: 'Selecione um cliente (opcional)' },
                  class: 'form-select' %>
              <small class="form-text text-muted">Opcional - deixe em branco para uso anônimo</small>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <%= form.label :billing_type, 'Tipo de Cobrança', class: 'form-label' %>
              <%= form.select :billing_type,
                  [['Pós-pago (Cobrar no final)', 'pós-pago'], ['Pré-pago', 'pré-pago'], ['Pacote', 'pacote']],
                  {},
                  class: 'form-select',
                  id: 'billing_type_select' %>
            </div>
          </div>

          <div class="col-md-6" id="package_minutes_field" style="display: none;">
            <div class="mb-3">
              <%= form.label :package_minutes, 'Minutos do Pacote', class: 'form-label' %>
              <%= form.number_field :package_minutes, class: 'form-control', min: 15, step: 15 %>
              <small class="form-text text-muted">Apenas para tipo 'Pacote'</small>
            </div>
          </div>
        </div>

        <div class="d-flex gap-2">
          <%= form.submit 'Iniciar Sessão', class: 'btn btn-success', disabled: @available_machines.empty? %>
          <%= link_to 'Cancelar', lan_machines_path, class: 'btn btn-secondary' %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const billingTypeSelect = document.getElementById('billing_type_select');
    const packageMinutesField = document.getElementById('package_minutes_field');

    billingTypeSelect.addEventListener('change', function() {
      if (this.value === 'pacote') {
        packageMinutesField.style.display = 'block';
      } else {
        packageMinutesField.style.display = 'none';
      }
    });
  });
</script>
