<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-people"></i> Gestão de Usuários</h1>
    <%= link_to new_user_path, class: 'btn btn-primary' do %>
      <i class="bi bi-plus-circle"></i> Novo Usuário
    <% end %>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-dark">
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Função</th>
              <th>Departamento</th>
              <th>Status</th>
              <th>Permissões</th>
              <th class="text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <tr>
                <td><%= user.name %></td>
                <td><%= user.email %></td>
                <td>
                  <span class="badge bg-info">
                    <%= user.role.humanize %>
                  </span>
                </td>
                <td>
                  <% if user.department.present? %>
                    <span class="badge bg-secondary">
                      <%= user.department.humanize %>
                    </span>
                  <% else %>
                    <span class="text-muted">-</span>
                  <% end %>
                </td>
                <td>
                  <% if user.access_locked? %>
                    <span class="badge bg-danger">Bloqueado</span>
                  <% elsif user.active? %>
                    <span class="badge bg-success">Ativo</span>
                  <% else %>
                    <span class="badge bg-warning">Inativo</span>
                  <% end %>
                </td>
                <td>
                  <% if user.super_admin == true %>
                    <span class="badge bg-danger">Super Admin</span>
                  <% elsif user.admin? %>
                    <span class="badge bg-warning">Admin</span>
                  <% end %>
                  <% if user.financial_director? %>
                    <span class="badge bg-primary">Dir. Financeira</span>
                  <% end %>
                </td>
                <td>
                  <div class="btn-group" role="group">
                    <%= link_to edit_user_path(user), class: 'btn btn-sm btn-outline-primary', title: 'Editar' do %>
                      <i class="bi bi-pencil"></i>
                    <% end %>

                    <%= button_to reset_password_user_path(user),
                        method: :post,
                        class: 'btn btn-sm btn-outline-warning',
                        title: 'Resetar Senha',
                        form: { data: { turbo_confirm: 'Tem certeza que deseja resetar a senha deste usuário?' } } do %>
                      <i class="bi bi-key"></i>
                    <% end %>

                    <% if user.access_locked? %>
                      <%= button_to unlock_account_user_path(user),
                          method: :post,
                          class: 'btn btn-sm btn-outline-success',
                          title: 'Desbloquear',
                          form: { data: { turbo_confirm: 'Tem certeza que deseja desbloquear esta conta?' } } do %>
                        <i class="bi bi-unlock"></i>
                      <% end %>
                    <% else %>
                      <%= button_to lock_account_user_path(user),
                          method: :post,
                          class: 'btn btn-sm btn-outline-danger',
                          title: 'Bloquear',
                          form: { data: { turbo_confirm: 'Tem certeza que deseja bloquear esta conta?' } } do %>
                        <i class="bi bi-lock"></i>
                      <% end %>
                    <% end %>

                    <% unless user == current_user || (user.super_admin? && User.where(super_admin: true).count <= 1) %>
                      <%= button_to user_path(user),
                          method: :delete,
                          class: 'btn btn-sm btn-outline-danger',
                          title: 'Deletar Usuário',
                          form: { data: { turbo_confirm: 'ATENÇÃO: Tem certeza que deseja DELETAR este usuário? Esta ação não pode ser desfeita!' } } do %>
                        <i class="bi bi-trash"></i>
                      <% end %>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
